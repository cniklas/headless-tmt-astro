---
import { siteName, getPages } from '../lib/api.js';

const pages = await getPages()

const staticLinks = [
	{ url: 'https://tmt-ton.netlify.app', text: 'Ton' },
	{ url: 'https://tmt-support.netlify.app', text: 'Support' },
	{ url: 'https://myplanner.de/tmt/wp-admin', text: 'Login' },
]

const { slug } = Astro.props;
---

<div class="mx-auto mt-0 flex w-full flex-wrap items-center justify-between py-3 md:max-w-4xl">
	<div class="pl-4">
		<a class="text-xl font-bold text-gray-900 dark:text-gray-400" href="/">
			{siteName}
		</a>
	</div>

	<div class="block pr-4 lg:hidden">
		<button id="js-menu-button"
			class="dark-hover:text-gray-300 flex appearance-none items-center rounded border border-gray-600 px-3 py-2 text-gray-500 hover:border-teal-500 hover:text-gray-900 focus:outline-none">
			<svg class="h-3 w-3 fill-current" viewBox="0 0 20 20" xmlns="http://www.w3.org/2000/svg">
				<title>Menu</title>
				<path d="M0 3h20v2H0V3zm0 6h20v2H0V9zm0 6h20v2H0v-2z" />
			</svg>
		</button>
	</div>

	<div id="js-menu"
		class="z-20 mt-2 hidden w-full flex-grow bg-white dark:bg-gray-900 md:bg-transparent lg:mt-0 lg:block lg:w-auto">
		<ul class="list-reset items-center justify-end lg:flex">
			{pages.map(item => (
			<li class={`lg:mr-3 ${item.isHome ? 'lg:hidden' : '' }`}>
				<a class={`block lg:inline-block py-2 px-4 text-gray-600 dark:text-gray-500 hover:text-gray-900
					dark-hover:text-gray-300 hover:underline ${item.slug===slug ? 'is-active' : '' }`} href={`/${item.isHome ? ''
					: item.slug}`}>{item.isHome ? 'Home' : item.title.rendered}</a>
			</li>
			))}

			{staticLinks.map(item => (
			<li class="lg:mr-3">
				<a class="dark-hover:text-gray-300 block py-2 px-4 text-gray-600 hover:text-gray-900 hover:underline dark:text-gray-500 lg:inline-block"
					href={item.url}>{item.text}</a>
			</li>
			))}
		</ul>
	</div>
</div>

<script>
	let clicked = false
	const menu = document.querySelector('#js-menu')
	const button = document.querySelector('#js-menu-button')
	button.addEventListener('click', function () {
		if (clicked) return
		clicked = true
		menu.classList.toggle('hidden')
		setTimeout(function () {
			clicked = false
		}, 100)
	})
</script>

<style lang="postcss">
	.is-active {
		@apply text-gray-900 font-bold;

		@media (prefers-color-scheme: dark) {
			@apply text-gray-300 font-semibold;
		}

		&:hover {
			@apply no-underline;
		}
	}
</style>